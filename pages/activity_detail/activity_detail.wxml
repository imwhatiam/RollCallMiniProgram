<home-button />
<view class="container">
  <view class="header">
    <block wx:if="{{isEditingActivityTitle}}">
      <input class="name-input"
            value="{{activityTitle}}"
            bindinput="handleActivityTitleInput"
            bindblur="saveActivityTitle"
            focus="{{isEditingActivityTitle}}" />
    </block>
    <block wx:else>
      <view class="name-display" bindtap="startEditingActivityTitle">
        {{activityTitle || '点击输入名称'}}
      </view>
    </block>
  </view>

  <view class="activity-list-item">
    <block wx:for="{{activityItems}}" wx:key="index">

      <view wx:if="{{item.status == 'completed'}}" class="list-item completed">
        <button
          class="complete-btn"
          bindtap="{{item.operator !== openid ? '' : 'handleUncompleteItem'}}"
          data-index="{{index}}"
          disabled="{{item.operator !== openid}}"
        >✓</button>
        <text class="item-text">{{index}}, {{item.name}}</text>
      </view>

      <view wx:elif="{{item.status == 'deleted'}}" class="list-item deleted">
        <text class="item-text">{{index}}, {{item.name}}</text>
        <button
          class="delete-btn"
          bindtap="{{item.operator !== openid ? '' : 'handleUndeleteItem'}}"
          data-index="{{index}}"
          disabled="{{item.operator !== openid}}"
        >x</button>
        <button
          class="delete-btn"
          bindtap="{{item.operator !== openid ? '' : 'handleDeleteItemCompletely'}}"
          data-index="{{index}}"
          data-name="{{item.name}}"
          disabled="{{item.operator !== openid}}"
        >彻底删除</button>
      </view>

      <view wx:else class="list-item">
        <button class="complete-btn" bindtap="handleCompleteItem" data-index="{{index}}">完成</button>
        <text class="{{showFullTextIndex===index ? 'item-full-text' : 'item-text'}}" bindlongpress="showFullText" bindtouchend="hideFullText" data-index="{{index}}">{{index}}, {{item.name}}</text>
        <block wx:if="{{showFullTextIndex!==index}}">
          <button class="delete-btn" bindtap="handleDeleteItem" data-index="{{index}}">删除</button>
        </block>
      </view>
    </block>
  </view>

  <view class="bottom-view">
    <input
      type="text"
      placeholder="请输入新人员/子事项"
      bindinput="handleNewItemInput"
      value="{{newItemName}}"
    />
    <button class="create-save-update-btn" bindtap="addNewItem">添加</button>
  </view>
</view>
